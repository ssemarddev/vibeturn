import{A as G,q as Y,j as e,r as d,bj as A,T as n,N as H,a2 as K,b3 as q,F as O,b8 as y,aG as I,bB as v,B as x,L as h,bC as Q,aa as W,k as z,$ as M,u as T,a0 as P,a1 as C,bD as V,ay as j,K as f,ba as J,x as b,bs as S,bt as X,bE as Z,V as R,ak as ee,i as se,w as ae,ac as ne,au as te,bn as ie}from"./main-41809f72.js";import{C as le}from"./CalendarToday-be88c87d.js";import{S as re,O as ce,B as N,a as m,u as de,b as oe}from"./use-resume-subscription-15733939.js";import{E}from"./Edit-c859bb2c.js";import{S as me,l as xe,B as ue}from"./billing-redirect-message-62342ce0.js";import"./MoreHoriz-ce427370.js";import"./TaskAlt-48a4f2b3.js";function o(){var a,i,l;const s=G("me",{with:["subscriptions.product","subscriptions.price"]});return{subscription:(i=(a=s.data)==null?void 0:a.user.subscriptions)==null?void 0:i[0],isLoading:s.isLoading,user:(l=s.data)==null?void 0:l.user}}function _(){Y.invalidateQueries({queryKey:["users"]})}function Ge(){const s=o();return e.jsxs(d.Fragment,{children:[e.jsx(A,{children:e.jsx(n,{message:"Billing"})}),e.jsx(H,{menuPosition:"billing-page"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"container mx-auto my-24 flex-auto px-24",children:s.isLoading?e.jsx(K,{className:"my-80","aria-label":"Loading user..",isIndeterminate:!0}):e.jsx(q,{})}),e.jsx(O,{className:"container mx-auto px-24"})]})]})}function p({title:s,children:t}){return e.jsxs("div",{className:"mb-64",children:[e.jsx("div",{className:"text-sm font-medium uppercase pb-16 mb-16 border-b",children:s}),t]})}function ge(){const{subscription:s}=o();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const t=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(y,{preset:"long",date:s.ends_at})});return e.jsx(p,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex flex-col justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx(I,{className:"mb-10 w-min",size:"xs",radius:"rounded",color:"danger",children:e.jsx(n,{message:"Canceled"})}),e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(v,{className:"mb-8 text-xl",price:s.price}),e.jsxs("div",{className:"flex items-center gap-8 text-base",children:[e.jsx(le,{size:"sm",className:"text-muted"}),e.jsx("div",{className:"flex-auto",children:e.jsx(n,{message:"Your plan will be canceled on :date",values:{date:t}})})]})]}),e.jsx("div",{className:"w-[233px]",children:e.jsx(x,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:h,to:"/billing/renew",children:e.jsx(n,{message:"Renew plan"})})})]})})}function je(){const{subscription:s}=o();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const t=e.jsx(y,{preset:"long",date:s.renews_at});return e.jsxs(d.Fragment,{children:[s.past_due?e.jsx(he,{}):null,e.jsx(p,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"mt-24 flex justify-between gap-20",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 text-xl font-bold",children:s.product.name}),e.jsx(v,{className:"mb-2 text-xl",price:s.price}),e.jsx("div",{className:"text-base",children:e.jsx(n,{message:"Your plan renews on :date",values:{date:t}})})]}),e.jsxs("div",{className:"w-[233px]",children:[e.jsx(x,{variant:"flat",color:"primary",size:"md",className:"mb-12 w-full",elementType:h,to:"/billing/change-plan",disabled:s.gateway_name==="none",children:e.jsx(n,{message:"Change plan"})}),e.jsx(x,{variant:"outline",color:"danger",size:"md",className:"w-full",elementType:h,to:"/billing/cancel",children:e.jsx(n,{message:"Cancel plan"})})]})]})})]})}function he(){return e.jsx(re,{className:"mb-24",color:"danger",title:"Payment is past due",description:"Your recent recurring payment has failed with the payment method we have on file. Please update your payment method to avoid any service interruptions."})}const pe=""+new URL("paypal-c2a77c63.svg",import.meta.url).href;function fe(){const{user:s,subscription:t}=o();if(!s||!t)return null;const i=t.gateway_name==="paypal"?ye:be;return e.jsx(p,{title:e.jsx(n,{message:"Payment method"}),children:e.jsx(i,{methodClassName:"whitespace-nowrap text-base max-w-[464px] flex items-center gap-10",linkClassName:"flex items-center gap-4 text-muted mt-18 block hover:underline"})})}function be({methodClassName:s,linkClassName:t}){const{user:a}=o();return a?e.jsxs(d.Fragment,{children:[e.jsxs("div",{className:s,children:[e.jsx("span",{className:"capitalize",children:a.card_brand})," ••••",a.card_last_four,a.card_expires&&e.jsx("div",{className:"ml-auto",children:e.jsx(n,{message:"Expires :date",values:{date:a.card_expires}})})]}),e.jsxs(h,{className:t,to:"/billing/change-payment-method",children:[e.jsx(E,{size:"sm"}),e.jsx(n,{message:"Change payment method"})]})]}):null}function ye({methodClassName:s,linkClassName:t}){const{subscription:a}=o();return e.jsxs(d.Fragment,{children:[e.jsx("div",{className:s,children:e.jsx(Q,{src:pe})}),e.jsxs("a",{className:t,href:`https://www.sandbox.paypal.com/myaccount/autopay/connect/${a==null?void 0:a.gateway_id}/funding`,target:"_blank",rel:"noreferrer",children:[e.jsx(E,{size:"sm"}),e.jsx(n,{message:"Change payment method"})]})]})}const U="billing/invoices";function ve(s){return W({queryKey:[U],queryFn:()=>Ne(s)})}function Ne(s){return z.get(U,{params:{userId:s}}).then(t=>t.data)}function we(){var i;const{user:s}=o(),t=ve(s==null?void 0:s.id);if(!s)return null;const a=(i=t.data)==null?void 0:i.invoices;return e.jsx(p,{title:e.jsx(n,{message:"Payment history"}),children:e.jsx("div",{className:"max-w-[464px]",children:e.jsx(M,{initial:!1,mode:"wait",children:t.isLoading?e.jsx(Ce,{},"loading-skeleton"):e.jsx(Pe,{invoices:a},"invoices")})})})}function Pe({invoices:s}){const{base_url:t}=T();return e.jsxs(P.div,{...C,children:[s!=null&&s.length?void 0:e.jsx("div",{className:"italic text-muted",children:e.jsx(n,{message:"No invoices yet"})}),s==null?void 0:s.map(a=>{var i;return e.jsxs("div",{className:"mb-14 flex items-center justify-between gap-10 whitespace-nowrap text-base",children:[e.jsxs("a",{href:`${t}/billing/invoices/${a.uuid}`,target:"_blank",className:"flex items-center gap-8 hover:underline",rel:"noreferrer",children:[e.jsx(y,{date:a.created_at}),e.jsx(ce,{size:"xs"})]}),a.subscription.price&&e.jsx("div",{children:e.jsx(V,{value:a.subscription.price.amount,currency:a.subscription.price.currency})}),e.jsx(I,{size:"xs",color:a.paid?"positive":"danger",radius:"rounded",children:a.paid?e.jsx(n,{message:"Paid"}):e.jsx(n,{message:"Unpaid"})}),e.jsx("div",{children:(i=a.subscription.product)==null?void 0:i.name})]},a.id)})]})}function Ce(){return e.jsxs(P.div,{...C,children:[e.jsx(j,{className:"mb-14"}),e.jsx(j,{className:"mb-14"}),e.jsx(j,{className:"mb-14"}),e.jsx(j,{className:"mb-14"}),e.jsx(j,{})]})}function Ye(){const{subscription:s}=o();if(!(s!=null&&s.price)||!(s!=null&&s.product))return null;const t=s.ends_at?e.jsx(ge,{}):e.jsx(je,{});return e.jsxs("div",{children:[t,e.jsx(fe,{}),e.jsx(we,{})]})}const Se="/billing";function Ae(){const s=f();return e.jsxs(d.Fragment,{children:[e.jsxs(N,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(Se),children:e.jsx(n,{message:"Billing"})}),e.jsx(m,{children:e.jsx(n,{message:"Payment method"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(n,{message:"Change payment method"})}),e.jsx(q,{})]})}const _e="/billing";function He(){const{base_url:s}=T();return e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx(me,{type:"setupIntent",submitLabel:e.jsx(n,{message:"Change"}),returnUrl:`${s}/billing/change-payment-method/done`}),e.jsx(x,{variant:"outline",className:"mt-16 w-full",size:"md",to:_e,elementType:h,type:"button",children:e.jsx(n,{message:"Go back"})})]})}const D="/billing";function Ke(){const{billing:{stripe_public_key:s}}=T(),t=f(),[a]=J(),i=a.get("setup_intent_client_secret"),[l,r]=d.useState(),c=d.useRef();return d.useEffect(()=>{c.current||!i||(xe(s).then(u=>{if(!u){r($());return}u.retrieveSetupIntent(i).then(({setupIntent:g})=>{(g==null?void 0:g.status)==="succeeded"&&ke(g.payment_method).then(()=>{_()}),r($(g==null?void 0:g.status))})}),c.current=!0)},[s,i]),i?e.jsx(ue,{config:l}):(t(D),null)}function $(s){switch(s){case"succeeded":return{...w,message:b("Payment method changed successfully!"),status:"success"};case"processing":return{...w,message:b("Your request is processing. We'll update you when your payment method is confirmed."),status:"success"};case"requires_payment_method":return{...w,message:b("Payment method confirmation failed. Please try another payment method."),status:"error"};default:return{...w,message:b("Something went wrong"),status:"error"}}}const w={link:D,buttonLabel:b("Go back")};function ke(s){return z.post("billing/stripe/change-default-payment-method",{payment_method_id:s})}function Oe(){const s=f();return e.jsxs(d.Fragment,{children:[e.jsxs(N,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s("/billing"),children:e.jsx(n,{message:"Billing"})}),e.jsx(m,{children:e.jsx(n,{message:"Plans"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(n,{message:"Change your plan"})}),e.jsx(p,{title:e.jsx(n,{message:"Available plans"}),children:e.jsx(M,{initial:!1,mode:"wait",children:e.jsx(Be,{})})})]})}function Be(){var i,l;const s=S(),[t,a]=d.useState("monthly");return s.isLoading?e.jsx(ze,{},"plan-skeleton"):e.jsxs(d.Fragment,{children:[e.jsx(X,{products:(i=s.data)==null?void 0:i.products,selectedCycle:t,onChange:a,className:"mb-20",size:"md"}),(l=s.data)==null?void 0:l.products.map(r=>{const c=Z(t,r.prices);return!c||r.hidden?null:d.createElement(P.div,{...C,key:r.id,className:"justify-between gap-40 border-b py-32 md:flex"},e.jsxs("div",{className:"mb-40 md:mb-0",children:[e.jsx("div",{className:"text-xl font-bold",children:r.name}),e.jsx(v,{price:c,className:"text-lg"}),e.jsx("div",{className:"mt-12 text-base",children:r.description}),e.jsx(Le,{plan:r})]}),e.jsx(Fe,{product:r,price:c}))})]},"plan-list")}function Le({plan:s}){return s.feature_list.length?e.jsxs("div",{className:"mt-32",children:[e.jsx("div",{className:"mb-10 text-sm font-semibold",children:e.jsx(n,{message:"What's included"})}),s.feature_list.map(t=>e.jsxs("div",{className:"flex items-center gap-10 text-sm",children:[e.jsx(R,{className:"text-positive",size:"sm"}),e.jsx(n,{message:t})]},t))]}):null}function Fe({product:s,price:t}){const{subscription:a}=o();return!(a!=null&&a.price)||!(a!=null&&a.product)?null:a.product_id===s.id&&a.price_id===t.id?e.jsxs("div",{className:"flex w-[168px] items-center justify-center gap-10 text-muted",children:[e.jsx(R,{size:"md"}),e.jsx(n,{message:"Current plan"})]}):e.jsx(x,{variant:"flat",color:"primary",className:"w-[168px]",size:"md",elementType:h,to:`/billing/change-plan/${s.id}/${t.id}/confirm`,children:e.jsx(n,{message:"Continue"})})}function ze(){return e.jsxs(P.div,{...C,className:"border-b py-32 text-2xl",children:[e.jsx(j,{className:"mb-8"}),e.jsx(j,{className:"mb-14"}),e.jsx(j,{className:"mb-24"}),e.jsx(j,{className:"mb-12"})]},"plan-skeleton")}function Te(){const{trans:s}=ee(),t=f();return se({mutationFn:a=>$e(a),onSuccess:()=>{ae(s(b("Plan changed."))),_(),t("/billing")},onError:a=>ne(a)})}function $e({subscriptionId:s,...t}){return z.post(`billing/subscriptions/${s}/change-plan`,t).then(a=>a.data)}const B="/billing/change-plan";function Qe(){const{productId:s,priceId:t}=te(),a=f(),i=S(),{subscription:l}=o(),r=Te();if(!i.data||(l==null?void 0:l.price_id)==t)return e.jsx(ie,{to:"/billing/change-plan",replace:!0});const c=i.data.products.find(k=>`${k.id}`===s),u=c==null?void 0:c.prices.find(k=>`${k.id}`===t);if(!c||!u||!l)return a(B),null;const g=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(y,{date:l.renews_at,preset:"long"}),";"]});return e.jsxs(d.Fragment,{children:[e.jsxs(N,{children:[e.jsx(m,{isLink:!0,onSelected:()=>a("/billing"),children:e.jsx(n,{message:"Billing"})}),e.jsx(m,{onSelected:()=>a(B),children:e.jsx(n,{message:"Plans"})}),e.jsx(m,{children:e.jsx(n,{message:"Confirm"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(n,{message:"Confirm your new plan"})}),e.jsx(p,{title:e.jsx(n,{message:"Changing to"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:c.name}),e.jsx(v,{price:u,className:"text-lg"}),e.jsx("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:e.jsx(n,{message:"You will be charged the new price starting :date",values:{date:g}})}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(x,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:()=>{r.mutate({subscriptionId:l.id,newProductId:c.id,newPriceId:u.id})},disabled:r.isPending,children:e.jsx(n,{message:"Confirm"})})}),e.jsx("div",{children:e.jsx(x,{variant:"outline",className:"w-full",to:B,elementType:h,children:e.jsx(n,{message:"Go back"})})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(n,{message:"By confirming your new plan, you agree to our terms of Service and privacy policy."})})]})]})})]})}const L="/billing";function We(){const s=f(),t=S(),{subscription:a}=o(),i=de(),l=a==null?void 0:a.product,r=a==null?void 0:a.price;if(!t.data)return null;if(!a||!l||!r)return s(L),null;const c=e.jsx("span",{className:"whitespace-nowrap",children:e.jsx(y,{date:a.renews_at,preset:"long"})}),u=()=>{i.mutate({subscriptionId:a.id},{onSuccess:()=>{_(),s("/billing")}})};return e.jsxs(d.Fragment,{children:[e.jsxs(N,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(L),children:e.jsx(n,{message:"Billing"})}),e.jsx(m,{children:e.jsx(n,{message:"Cancel"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(n,{message:"Cancel your plan"})}),e.jsx(p,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:l.name}),e.jsx(v,{price:r,className:"text-lg"}),e.jsxs("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:[e.jsx(n,{message:"Your plan will be canceled, but is still available until the end of your billing period on :date",values:{date:c}}),e.jsx("div",{className:"mt-20",children:e.jsx(n,{message:"If you change your mind, you can renew your subscription."})})]}),e.jsxs("div",{children:[e.jsx("div",{children:e.jsx(x,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:u,disabled:i.isPending,children:e.jsx(n,{message:"Cancel plan"})})}),e.jsx("div",{children:e.jsx(x,{variant:"outline",className:"w-full",to:L,elementType:h,children:e.jsx(n,{message:"Go back"})})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(n,{message:"By cancelling your plan, you agree to our terms of service and privacy policy."})})]})]})})]})}const F="/billing";function Ve(){const s=f(),t=S(),{subscription:a}=o(),i=oe(),l=a==null?void 0:a.product,r=a==null?void 0:a.price;if(!t.data)return null;if(!a||!l||!r)return s(F),null;const c=e.jsxs("span",{className:"whitespace-nowrap",children:[e.jsx(y,{date:a.ends_at,preset:"long"}),";"]}),u=()=>{i.mutate({subscriptionId:a.id},{onSuccess:()=>{_(),s("/billing")}})};return e.jsxs(d.Fragment,{children:[e.jsxs(N,{children:[e.jsx(m,{isLink:!0,onSelected:()=>s(F),children:e.jsx(n,{message:"Billing"})}),e.jsx(m,{children:e.jsx(n,{message:"Renew"})})]}),e.jsx("h1",{className:"my-32 text-3xl font-bold md:my-64",children:e.jsx(n,{message:"Renew your plan"})}),e.jsx(p,{title:e.jsx(n,{message:"Current plan"}),children:e.jsxs("div",{className:"max-w-[464px]",children:[e.jsx("div",{className:"text-xl font-bold",children:l.name}),e.jsx(v,{price:r,className:"text-lg"}),e.jsx("div",{className:"mb-48 mt-12 border-b pb-24 text-base",children:e.jsx(n,{message:"This plan will no longer be canceled. It will renew on :date",values:{date:c}})}),e.jsx(x,{variant:"flat",color:"primary",size:"md",className:"mb-16 w-full",onClick:u,disabled:i.isPending,children:e.jsx(n,{message:"Renew plan"})}),e.jsx(x,{variant:"outline",className:"w-full",to:F,elementType:h,children:e.jsx(n,{message:"Go back"})}),e.jsx("div",{className:"mt-12 text-xs text-muted",children:e.jsx(n,{message:"By renewing your plan, you agree to our terms of service and privacy policy."})})]})})]})}export{Ye as BillingPage,Ge as BillingPageLayout,Ke as ChangePaymentMethodDone,Ae as ChangePaymentMethodLayout,He as ChangePaymentMethodPage,Oe as ChangePlanPage,We as ConfirmPlanCancellationPage,Qe as ConfirmPlanChangePage,Ve as ConfirmPlanRenewalPage};
//# sourceMappingURL=billing-page-routes.lazy-011f2b18.js.map
